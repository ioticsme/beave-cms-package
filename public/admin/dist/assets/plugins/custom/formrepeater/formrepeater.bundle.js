var identity=function(t){return t},isArray=function(t){return $.isArray(t)},isObject=function(t){return!isArray(t)&&t instanceof Object},isNumber=function(t){return t instanceof Number},isFunction=function(t){return t instanceof Function},indexOf=function(t,e){return $.inArray(e,t)},inArray=function(t,e){return-1!==indexOf(t,e)},foreach=function(t,e){for(var n in t)t.hasOwnProperty(n)&&e(t[n],n,t)},last=function(t){return t[t.length-1]},argumentsToArray=function(t){return Array.prototype.slice.call(t)},extend=function(){var n={};return foreach(argumentsToArray(arguments),function(t){foreach(t,function(t,e){n[e]=t})}),n},mapToArray=function(t,r){var i=[];return foreach(t,function(t,e,n){i.push(r(t,e,n))}),i},mapToObject=function(t,r,i){var a={};return foreach(t,function(t,e,n){e=i?i(e,t):e,a[e]=r(t,e,n)}),a},map=function(t,e,n){return isArray(t)?mapToArray(t,e):mapToObject(t,e,n)},pluck=function(t,e){return map(t,function(t){return t[e]})},filter=function(t,r){var i;return isArray(t)?(i=[],foreach(t,function(t,e,n){r(t,e,n)&&i.push(t)})):(i={},foreach(t,function(t,e,n){r(t,e,n)&&(i[e]=t)})),i},call=function(t,n,r){return map(t,function(t,e){return t[n].apply(t,r||[])})},throttle=function(e,n){var r=null;return function(){var t=arguments;null===r&&(r=setTimeout(function(){r=null},e),n.apply(this,t))}},mixinPubSub=function(t){var r={};return(t=t||{}).publish=function(t,e){foreach(r[t],function(t){t(e)})},t.subscribe=function(t,e){r[t]=r[t]||[],r[t].push(e)},t.unsubscribe=function(n){foreach(r,function(t){var e=indexOf(t,n);-1!==e&&t.splice(e,1)})},t};!function(c){function r(t){var e={};return(t=u(t,e)).getType=function(){return"button"},t.$().on("change",function(t){e.publishChange(t,this)}),t}function o(t){var e={},n=u(t,e);return n.getType=function(){return"checkbox"},n.get=function(){var t=[];return n.$().filter(":checked").each(function(){t.push(c(this).val())}),t},n.set=function(t){t=isArray(t)?t:[t],n.$().each(function(){c(this).prop("checked",!1)}),foreach(t,function(t){n.$().filter('[value="'+t+'"]').prop("checked",!0)})},e.equalTo=b,n.$().change(function(t){e.publishChange(t,this)}),n}function f(t){return(t=x(t,{})).getType=function(){return"email"},t}function s(t){var e={},n=a(t,e);return n.getType=function(){return"file"},n.get=function(){return last(n.$().val().split("\\"))},n.clear=function(){this.$().each(function(){c(this).wrap("<form>").closest("form").get(0).reset(),c(this).unwrap()})},n.$().change(function(t){e.publishChange(t,this)}),n}function l(t){var e={};return(t=u(t,e)).getType=function(){return"hidden"},t.$().change(function(t){e.publishChange(t,this)}),t}function p(t){var e={},r=a(t,e);return r.getType=function(){return"file[multiple]"},r.get=function(){for(var t=r.$().get(0).files||[],e=[],n=0;n<(t.length||0);n+=1)e.push(t[n].name);return e},r.clear=function(){this.$().each(function(){c(this).wrap("<form>").closest("form").get(0).reset(),c(this).unwrap()})},r.$().change(function(t){e.publishChange(t,this)}),r}function h(t){var e={},n=u(t,e);return n.getType=function(){return"select[multiple]"},n.get=function(){return n.$().val()||[]},n.set=function(t){n.$().val(""===t?[]:isArray(t)?t:[t])},e.equalTo=b,n.$().change(function(t){e.publishChange(t,this)}),n}function d(t){return(t=x(t,{})).getType=function(){return"password"},t}function m(t){var e={},n=u(t,e);return n.getType=function(){return"radio"},n.get=function(){return n.$().filter(":checked").val()||null},n.set=function(t){t?n.$().filter('[value="'+t+'"]').prop("checked",!0):n.$().each(function(){c(this).prop("checked",!1)})},n.$().change(function(t){e.publishChange(t,this)}),n}function y(t){var e={};return(t=u(t,e)).getType=function(){return"range"},t.$().change(function(t){e.publishChange(t,this)}),t}function g(t){var e={};return(t=u(t,e)).getType=function(){return"select"},t.$().change(function(t){e.publishChange(t,this)}),t}function v(t){var e={};return(t=u(t,e)).getType=function(){return"textarea"},t.$().on("change keyup keydown",function(t){e.publishChange(t,this)}),t}function $(t){return(t=x(t,{})).getType=function(){return"url"},t}function i(t){function e(e,t){(isObject(t)?t:a.find(t)).each(function(){var t=c(this).attr("name");i[t]=u[e]({$:c(this)})})}function n(e,t){var n=[],r=isObject(t)?t:a.find(t);isObject(t)?i[r.attr("name")]=u[e]({$:r}):(r.each(function(){-1===indexOf(n,c(this).attr("name"))&&n.push(c(this).attr("name"))}),foreach(n,function(t){i[t]=u[e]({$:a.find('input[name="'+t+'"]')})}))}var i={},a=t.$,u=t.constructorOverride||{button:r,text:x,url:$,email:f,password:d,range:y,textarea:v,select:g,"select[multiple]":h,radio:m,checkbox:o,file:s,"file[multiple]":p,hidden:l};return a.is("input, select, textarea")?a.is('input[type="button"], button, input[type="submit"]')?e("button",a):a.is("textarea")?e("textarea",a):a.is('input[type="text"]')||a.is("input")&&!a.attr("type")?e("text",a):a.is('input[type="password"]')?e("password",a):a.is('input[type="email"]')?e("email",a):a.is('input[type="url"]')?e("url",a):a.is('input[type="range"]')?e("range",a):a.is("select")?a.is("[multiple]")?e("select[multiple]",a):e("select",a):a.is('input[type="file"]')?a.is("[multiple]")?e("file[multiple]",a):e("file",a):a.is('input[type="hidden"]')?e("hidden",a):a.is('input[type="radio"]')?n("radio",a):a.is('input[type="checkbox"]')?n("checkbox",a):e("text",a):(e("button",'input[type="button"], button, input[type="submit"]'),e("text",'input[type="text"]'),e("password",'input[type="password"]'),e("email",'input[type="email"]'),e("url",'input[type="url"]'),e("range",'input[type="range"]'),e("textarea","textarea"),e("select","select:not([multiple])"),e("select[multiple]","select[multiple]"),e("file",'input[type="file"]:not([multiple])'),e("file[multiple]",'input[type="file"][multiple]'),e("hidden",'input[type="hidden"]'),n("radio",'input[type="radio"]'),n("checkbox",'input[type="checkbox"]')),i}var a=function(t,r){var i,a=mixinPubSub(),e=t.$;return a.getType=function(){throw'implement me (return type. "text", "radio", etc.)'},a.$=function(t){return t?e.find(t):e},a.disable=function(){a.$().prop("disabled",!0),a.publish("isEnabled",!1)},a.enable=function(){a.$().prop("disabled",!1),a.publish("isEnabled",!0)},r.equalTo=function(t,e){return t===e},r.publishChange=function(t,e){var n=a.get();r.equalTo(n,i)||a.publish("change",{e:t,domElement:e}),i=n},a},u=function(t,e){var n=a(t,e);return n.get=function(){return n.$().val()},n.set=function(t){n.$().val(t)},n.clear=function(){n.set("")},e.buildSetter=function(e){return function(t){e.call(n,t)}},n},b=function(t,e){t=isArray(t)?t:[t],e=isArray(e)?e:[e];var n=!0;return t.length!==e.length?n=!1:foreach(t,function(t){inArray(e,t)||(n=!1)}),n},x=function(t){var e={},t=u(t,e);return t.getType=function(){return"text"},t.$().on("change keyup keydown",function(t){e.publishChange(t,this)}),t};c.fn.inputVal=function(t){var e=c(this),n=i({$:e});return e.is("input, textarea, select")?void 0===t?n[e.attr("name")].get():(n[e.attr("name")].set(t),e):void 0===t?call(n,"get"):(foreach(t,function(t,e){n[e].set(t)}),e)},c.fn.inputOnChange=function(e){var t=c(this),n=i({$:t});return foreach(n,function(t){t.subscribe("change",function(t){e.call(t.domElement,t.e)})}),t},c.fn.inputDisable=function(){var t=c(this);return call(i({$:t}),"disable"),t},c.fn.inputEnable=function(){var t=c(this);return call(i({$:t}),"enable"),t},c.fn.inputClear=function(){var t=c(this);return call(i({$:t}),"clear"),t}}(jQuery),$.fn.repeaterVal=function(){var t,r,i=function(t){if(1===t.length&&(0===t[0].key.length||1===t[0].key.length&&!t[0].key[0]))return t[0].val;foreach(t,function(t){t.head=t.key.shift()});e={},foreach(t,function(t){e[t.head]||(e[t.head]=[]),e[t.head].push(t)});var e,n,r=e;return/^[0-9]+$/.test(t[0].head)?(n=[],foreach(r,function(t){n.push(i(t))})):(n={},foreach(r,function(t,e){n[e]=i(t)})),n};return i((t=$(this).inputVal(),r=[],foreach(t,function(t,e){var n=[];"undefined"!==e&&(n.push(e.match(/^[^\[]*/)[0]),n=n.concat(map(e.match(/\[[^\]]*\]/g),function(t){return t.replace(/[\[\]]/g,"")})),r.push({val:t,key:n}))}),r))},$.fn.repeater=function(m){var y;return m=m||{},$(this).each(function(){function n(){var t=u.data("repeater-list");return m.$parent?m.$parent.data("item-name")+"["+t+"]":t}var t=$(this),r=m.show||function(){$(this).show()},e=m.hide||function(t){t()},u=t.find("[data-repeater-list]").first(),c=function(t,e){return t.filter(function(){return!e||0===$(this).closest(pluck(e,"selector").join(",")).length})},i=function(){return c(u.find("[data-repeater-item]"),m.repeaters)},a=u.find("[data-repeater-item]").first().clone().hide(),o=c(c($(this).find("[data-repeater-item]"),m.repeaters).first().find("[data-repeater-delete]"),m.repeaters),f=(m.isFirstItemUndeletable&&o&&o.remove(),function(t){m.repeaters&&t.each(function(){var e=$(this);foreach(m.repeaters,function(t){e.find(t.selector).repeater(extend(t,{$parent:e}))})})}),s=function(t,e,n){t&&foreach(t,function(t){n.call(e.find(t.selector)[0],t)})},l=function(t,i,a){t.each(function(n){var r=$(this);r.data("item-name",i+"["+n+"]"),c(r.find("[name]"),a).each(function(){var t=$(this),e=t.attr("name").match(/\[[^\]]+\]/g),e=e?last(e).replace(/\[|\]/g,""):t.attr("name"),e=i+"["+n+"]["+e+"]"+(t.is(":checkbox")||t.attr("multiple")?"[]":"");t.attr("name",e),s(a,r,function(t){var e=$(this);l(c(e.find("[data-repeater-item]"),t.repeaters||[]),i+"["+n+"]["+e.find("[data-repeater-list]").first().data("repeater-list")+"]",t.repeaters)})})}),u.find("input[name][checked]").removeAttr("checked").prop("checked",!0)},p=(l(i(),n(),m.repeaters),f(i()),m.initEmpty&&i().remove(),m.ready&&m.ready(function(){l(i(),n(),m.repeaters)}),function(t,e){u.append(t),l(i(),n(),m.repeaters),t.find("[name]").each(function(){$(this).inputClear()}),h(t,e||m.defaultValues,m.repeaters)});function h(t,e,n){var r;(e||m.defaultValues)&&(r={},c(t.find("[name]"),n).each(function(){var t=$(this).attr("name").match(/\[([^\]]*)(\]|\]\[\])$/)[1];r[t]=$(this).attr("name")}),t.inputVal(map(filter(e||m.defaultValues,function(t,e){return r[e]}),identity,function(t){return r[t]}))),s(n,t,function(r){var i=$(this);c(i.find("[data-repeater-item]"),r.repeaters).each(function(){var n,t=i.find("[data-repeater-list]").data("repeater-list");e&&e[t]?(n=$(this).clone(),i.find("[data-repeater-item]").remove(),foreach(e[t],function(t){var e=n.clone();h(e,t,r.repeaters||[]),i.find("[data-repeater-list]").append(e)})):h($(this),r.defaultValues,r.repeaters||[])})})}var d=function(t){var e=a.clone();p(e,t),m.repeaters&&f(e),r.call(e.get(0))};y=function(t){i().remove(),foreach(t,d)},c(t.find("[data-repeater-create]"),m.repeaters).click(function(){d()}),u.on("click","[data-repeater-delete]",function(){var t=$(this).closest("[data-repeater-item]").get(0);e.call(t,function(){$(t).remove(),l(i(),n(),m.repeaters)})})}),this.setList=y,this};